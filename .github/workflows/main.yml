name: ğŸ–¥ï¸ RDP â€¢ Windows 11 â€¢ NGROK â€¢ FIXED

on:
  workflow_dispatch:

jobs:
  rdp:
    runs-on: windows-latest
    timeout-minutes: 3600

    steps:
    - name: ğŸ” Enable RDP
      run: |
        Set-ItemProperty 'HKLM:\System\CurrentControlSet\Control\Terminal Server' fDenyTSConnections 0
        Restart-Service TermService -Force

    - name: ğŸ‘¤ Create User
      run: |
        $u="WIN"
        $p="Rdp@13579!Zx"
        $s=ConvertTo-SecureString $p -AsPlainText -Force
        if(Get-LocalUser $u -ErrorAction SilentlyContinue){
          Set-LocalUser $u -Password $s
        } else {
          New-LocalUser $u -Password $s
          Add-LocalGroupMember Administrators $u
          Add-LocalGroupMember "Remote Desktop Users" $u
        }

    - name: ğŸŒ Install ngrok
      run: |
        Invoke-WebRequest https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-windows-amd64.zip -OutFile ngrok.zip
        tar -xf ngrok.zip

    - name: ğŸ”‘ Setup ngrok token
      run: |
        .\ngrok.exe config add-authtoken "${{ secrets.NGROK_AUTH_TOKEN }}"

    - name: ğŸš€ Run ngrok TCP
      run: |
        Write-Host "Starting ngrok..."
        .\ngrok.exe tcp 3389 --log=stdout
