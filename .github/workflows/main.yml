name: üñ•Ô∏è RDP ‚Ä¢ Windows 11 ‚Ä¢ Cloudflare

on:
  workflow_dispatch:

jobs:
  rdp:
    runs-on: windows-latest
    timeout-minutes: 3600

    steps:
    - name: üîê Enable RDP
      run: |
        Set-ItemProperty 'HKLM:\System\CurrentControlSet\Control\Terminal Server' fDenyTSConnections 0
        Restart-Service TermService -Force

    - name: üë§ Create User
      run: |
        $u="WIN"
        $p="Rdp@13579!Zx"
        $s=ConvertTo-SecureString $p -AsPlainText -Force
        if(Get-LocalUser $u -ErrorAction SilentlyContinue){
          Set-LocalUser $u -Password $s
        } else {
          New-LocalUser $u -Password $s
          Add-LocalGroupMember Administrators $u
          Add-LocalGroupMember "Remote Desktop Users" $u
        }

    - name: üåê Download cloudflared
      run: |
        Invoke-WebRequest https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.exe -OutFile cloudflared.exe

    - name: üöÄ Start RDP Tunnel
      run: |
        Write-Host "========== RDP INFO =========="
        Write-Host "USER : WIN"
        Write-Host "PASS : Rdp@13579!Zx"
        Write-Host "=============================="
        .\cloudflared.exe tunnel --url tcp://localhost:3389
